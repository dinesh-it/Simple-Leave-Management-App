var CLIENT_ID="YOUR-GOOGLE-DEVELOPER-API-CLIENT-ID",Type_Filter="PL SL ML PTL MTL RL WFH CO LOP HBD -".split(" "),remove_events="- HBD MTL PTL ML RL LOP".split(" "),Calendar_id="SHARED-CALENDAR-ID",total_emps=40,event_limits={PL:20,SL:10},admin_names={DINESH:1},HolidayList={"2018-01-01":"New Year","2018-01-26":"Republic Day*","2018-03-30":"Good Friday","2018-05-01":"May Day*","2018-08-15":"Independence Day*","2018-09-13":"Ganesh Chaturthi","2018-10-02":"Gandhi Jayanthi*","2018-10-19":"Vijayadashami",
"2018-11-08":"Deepavali (Balipadyami)","2018-12-25":"Christmas"};var CompanyHolidays,temp_types=[],all_events_report,count_table_timer,login_name="",calendar_iframe,cumulative_data={},cal_all_events,admin_login=!1,logged_in_user_data={},loging_data_computed=!1,show_graph_flag=!1,today=moment(),this_month=today.format("YYYY-MM"),today_date=today.format("YYYY-MM-DD"),today_tmrw=[today.format("DD"),today.clone().add(1,"days").format("DD")],today_events={},last_session_validated=0,DISCOVERY_DOCS=["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],SCOPES=
"https://www.googleapis.com/auth/calendar",authorizeButton,signoutButton,group_name_case_sensitive=0,group_first_name=1,help="group_name_case_sensitive, group_first_name, login_name, refresh_data().";
$(document).ready(function(){CompanyHolidays=_.keys(HolidayList);moment.locale("en-GB",{holidays:CompanyHolidays,holidayFormat:"YYYY-MM-DD",workingWeekdays:[1,2,3,4,5]});$(".filter-box").hide();$(window).on("focus",function(a){18E4<moment()-last_session_validated&&validate_session();return!1});$.each(Type_Filter,function(a,b){temp_types.push(b);temp_types.push("H"+b)});$(".company_name").text(company_name);authorizeButton=document.getElementById("authorize-button");signoutButton=document.getElementById("signout-button");
calendar_iframe='<iframe src="https://calendar.google.com/calendar/embed?src='+encodeURI(Calendar_id)+'&ctz=Asia/Calcutta" style="border: 0" width="800" height="600" frameborder="0" scrolling="no"></iframe>';init_holiday_list();initialize();bind_events()});
function init_holiday_list(){var a=$("#holidays_list tbody"),b=moment();for(key in HolidayList){var c=moment(key);d=c.format("DD-MM-YYYY - dddd");var e=c.format("ddd"),e="Sun"==e||"Sat"==e?"danger":"Fri"==e||"Mon"==e?"success":"info";c<b&&(e="warning past hide");a.append('<tr class="'+e+'"><td>'+d+"</td><td>"+HolidayList[key]+"</td></tr>")}$("#holiday-show-past").click(function(){$(this).hasClass("sp")?($(this).removeClass("sp").text("Hide Past Dates"),a.find(".past").removeClass("hide")):($(this).addClass("sp").text("Show Past Dates"),
a.find(".past").addClass("hide"))})}
function initialize(){$.fn.dataTableExt.afnFiltering.push(function(a,b,c){return"all-events"==a.sTableId?(a=b[0].replace(/ /g,"_"),b=$("#type_"+a).is(":checked"),!b&&a.match(/^H/i)&&"HBD"!=a&&(a=a.substring(1),b=$("#type_"+a).is(":checked")),b):!0});$("#datepicker-from").datepicker();$("#datepicker-to").datepicker();$("#add-from-date").datepicker({dateFormat:"dd/mm/yy"});$("#add-to-date").datepicker({dateFormat:"dd/mm/yy"});$("#all-events-report").dataTable();$(".options-box button").tooltip({placement:"bottom"})}
function bind_events(){$(document).on("click","td.link",function(){var b=$(this);progress_bar("Applying filter...");var a=$("td:first",b.parents("tr")).text(),b=$("#all-events-report th").eq(b.index()).text();console.log("Name: "+a+"Type: "+b);var e=$("#yadcf-filter--all-events-1"),f=$("#yadcf-filter--all-events-0");window.scrollTo(0,30);e.find('option[value="'+a+'"]').prop("selected",!0).trigger("change");f.find('option[value="'+b+'"]').prop("selected",!0).trigger("change");progress_bar("",!0);$("#filter-reset").removeClass("hide");
document.body.scrollTop=document.documentElement.scrollTop=0});$('input[name="add_event_day"]').on("change",function(){var b=$('input[name="add_event_day"]:checked').val();if("FULL"==b)$("#add-event-from-label").html("From"),$("#add-event-to").show(),$("#add-event-days-div").show();else if("FH"==b||"SH"==b)$("#add-event-from-label").html("On"),$("#add-event-to").hide(),$("#add-event-days-div").hide()});$("#filter-reset").on("click",function(){yadcf.exResetAllFilters(all_events_report);yadcf.exResetAllFilters(event_list_table);
$("#filter-reset").addClass("hide")});$("#show-graph").on("click",function(b){show_graph_flag?(show_graph_flag=!1,$("#chart-container").collapse("hide"),$("#chart-container-monthly").collapse("hide"),$("#chart-container-weekly").collapse("hide")):(show_graph_flag=!0,process_all_events(cal_all_events))});$("[id^=type_]").on("change",function(b){$("#all-events").dataTable().fnDraw()});$("#show_cal").on("click",function(){var b=$("#calender_view");b.hasClass("in")?b.collapse("hide"):(b.removeClass("hide"),
b.collapse("show"))});var a="";$("#global_search").on("keyup change",function(){a!=this.value.toUpperCase()&&($("#all-events").DataTable().search(this.value,!0,!0).draw(),a=this.value.toUpperCase())});event_list_table=$("#all-events").dataTable({bJQueryUI:!0,bProcessing:!0,ddCustomFilter:!0,order:[[2,"desc"]],bAutowidth:!1,iDisplayLength:50,drawCallback:function(){update_chart()},columnDefs:[{className:"hidden-xs",targets:[3,4]}],rowCallback:function(b,a,e){if(a[2]>=this_month)if(a[2]==today_date||
a[2]<this_month+"-31"&&a[4].match(today_tmrw[0]))$(b).addClass("today"),set_today_event(a);else if(a[2]>today_date){a=a[4].split(",");var f=0;$.each(a,function(a,c){parseInt(c)==parseInt(today_tmrw[1])&&($(b).addClass("tomorrow"),f=1)});f||$(b).addClass("future")}else a[4].match("to")?(e=moment(a[2].split("<br>")[0]),e=e.businessAdd(a[5],"days"),e>=today&&($(b).addClass("today"),set_today_event(a))):a[4].match(today_tmrw[1])&&$(b).addClass("tomorrow");else a[4].match("to")&&(e=moment(a[2].split("<br>")[0]),
e=e.add(a[5],"days"),e>=today&&($(b).addClass("today"),set_today_event(a)))}}).yadcf([{column_number:0},{column_number:1,text_data_delimiter:","},{column_number:3,text_data_delimiter:","},{column_number:4,text_data_delimiter:","}]);$("#event_type").change(function(b){b=$(this).val();var a="";if(event_limits[b]){var e=event_limits[b]-logged_in_user_data[b],a=(1<e?e+" leave(s)":0<e?e+" leave":"You don't have remaining "+b+"'s")+" remaining<sup>*</sup>";$("#add-event-days").attr("max",e)}else $("#add-event-days").attr("max",
120);$("#event-selector-info").html(a);b=b+": "+login_name;$("#new_event_name").val(b);$("#add-event-days").trigger("change")});$('input[name="add_event_day"]').change(function(b){b=$(this).val();var a=$("#event_type").val();b="FULL"==b?a+": "+login_name:"H"+a+": "+login_name;$("#new_event_name").val(b)});$("#new_event_name").on("focusout",function(b){$(this).prop("readonly",!0);$("#new_event_name_edit").text("Edit")});$("#new_event_name_edit").click(function(b){"Edit"==$(this).text()?($("#new_event_name").prop("readonly",
!1),$(this).text("Done")):($("#new_event_name").prop("readonly",!0),$(this).text("Edit"))});$("#show_add_event").click(function(){if(!validate_session())return!1;$("#event_type").trigger("change");$("#date-selector").trigger("change")});$("#date-selector").change(function(b,a){$("#date-selector-info").text("");var e=$(this).val(),f=moment().clone();if("today"==e){if(!f.isBusinessDay()){$("#date-selector-info").text(e+" holiday");$("#date-selector").val("tomorrow").trigger("change",{from_today:!0});
return}}else"tomorrow"==e?f.add(1,"days"):"yesterday"==e?f.subtract(1,"days"):"other"==e&&$("#advanced_mode").collapse("show");f.isBusinessDay()||"other"==e||(e+=" holiday",a&&a.from_today&&(e="today and "+e),$("#date-selector-info").text(e),$("#date-selector").val("other"),$("#advanced_mode").collapse("show"));$("#add-event-days").val(1).trigger("change");$("#add-from-date").datepicker("setDate",f.format("DD/MM/YYYY")).trigger("change")});$("#event_add_btn").click(function(){create_event(getFormDataAsJSON($("#add_event_form")))});
$("#add-event-days , #add-from-date").on("change",function(){var a=$("#add-event-days").val();a--;var c=moment($("#add-from-date").val(),"DD/MM/YYYY");c.isBusinessDay()?$("#add-from-date-info").text(""):$("#add-from-date-info").text("this day holiday");$("#add-to-date").datepicker("option","minDate",$("#add-from-date").val());$("#add-to-date").datepicker("setDate",c.businessAdd(a,"days").format("DD/MM/YYYY"));var c=$("#event_type").val(),e="";event_limits[c]&&(a=event_limits[c]-logged_in_user_data[c]-
a-1,e=0>a?-1*a+" LOP":0<a?a+" remaining":"Done!");$("#add-event-days-info").text(e)});$("#add-to-date").on("change",function(){var a=moment($("#add-from-date").val(),"DD/MM/YYYY"),c=moment($("#add-to-date").val(),"DD/MM/YYYY");c.isBusinessDay()?$("#add-to-date-info").text(""):$("#add-to-date-info").text("this day holiday");a=a.businessDiff(c);a++;$("#add-event-days").val(a).trigger("change")});$("#download_bi_monthly").on("click",function(a){progress_bar("Preparing download!");var c=getBiMonthlyTable(cumulative_data);
if(!c)return m_alert("No records found, Please select month which has data"),a.preventDefault(),a.stopPropagation(),progress_bar("",!0),0;a=ExcellentExport.excel(this,c.get(0),"Monthly Leaves");progress_bar("",!0);return a});$("#monthly-report").on("click",function(){if(!validate_session())return!1;var a=$("#bi-monthly-months");a.html("");$.each(cumulative_data,function(c,e){var f=$('<div class="form-check"><input class="form-check-input" type="checkbox" value="" id=""><label class="form-check-label" for=""></label></div>');
f.find("input").val(c).attr("id","bi-"+c);f.find("label").text(c).attr("for","bi-"+c);a.append(f)})})}
function print_fun_info(){var a=moment().startOf("year"),b=moment().endOf("year"),c=moment(),e=a.businessDiff(b,"days"),f=b.diff(a,"days");console.log("\nNot sure why you came to look for console!","\nBut here are some extra details I can give for you \n","\nLet's say all weekends are considered as holidays","\nAnd we have ",CompanyHolidays.length," gvt. holidays ",HolidayList,"\n \nSo, In this year we have: ",f," total days","\nand in that, we have only ",e," working days","\nand we also have 18PL + 12SL (30 leaves)",
"\n \nWhich means we have ",f-e," + ",30," leaves in this year :-)");console.log("Completed Working days: ",a.businessDiff(c,"days")-1);console.log("Remaining working days: ",c.businessDiff(b,"days ("+c.format("DD/MM/YY")+" to "+b.format("DD/MM/YY")+")"))}function handleClientLoad(){gapi.load("client:auth2",initClient)}
function initClient(){progress_bar("Initializing...");gapi.client.init({discoveryDocs:DISCOVERY_DOCS,clientId:CLIENT_ID,scope:SCOPES}).then(function(){progress_bar("Signing in...");gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());authorizeButton.onclick=handleAuthClick;signoutButton.onclick=handleSignoutClick;updateLoginInfo(gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile())})}
function updateSigninStatus(a){last_session_validated=moment();a?(progress_bar("SignIn Success!"),updateLoginInfo(gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile()),authorizeButton.style.display="none",signoutButton.style.display="inline",a=getUrlVars(),listEvents(a.from,a.to),$(".valid-session").show(),$("#sign-in-info").hide(),$(".filter-box").show(),$("#calendar_iframe").html(calendar_iframe),print_fun_info()):(progress_bar("Logged Out!"),authorizeButton.style.display="inline",signoutButton.style.display=
"none",$(".valid-session").hide(),$("#sign-in-info").show(),$(".filter-box").hide(),$("#calendar_iframe").html(""),progress_bar("",!0),setTimeout(function(){$(".processing").hide()},1E3));progress_bar("",!0)}function validate_session(){console.log("Validating Session!");last_session_validated=moment();if(gapi.auth2.getAuthInstance().isSignedIn.get())return!0;m_alert("Session expired!");updateSigninStatus(!1);return!1}
function handleAuthClick(a){progress_bar("",!0);gapi.auth2.getAuthInstance().signIn();$(".processing").show()}function handleSignoutClick(a){progress_bar("Logging Out!");gapi.auth2.getAuthInstance().signOut();location.reload();progress_bar("",!0)}
function listEvents(a,b){progress_bar("Fetching data...");a&&b||(a=moment().startOf("year").format("MM/DD/YYYY"),b=moment().endOf("year").format("MM/DD/YYYY"));var c=new Date(a);c.setUTCHours(0,0,0,0);var e=new Date(b);e.setUTCHours(23,59,59,999);c=c.toISOString();e=e.toISOString();$("#datepicker-from").datepicker("setDate",a);$("#datepicker-to").datepicker("setDate",b);gapi.client.calendar.events.list({calendarId:Calendar_id,timeMin:c,timeMax:e,showDeleted:!1,singleEvents:!0,maxResults:1E5,orderBy:"startTime"}).then(function(a){cal_all_events=
a=a.result.items;process_all_events(a);$.each(remove_events,function(a,b){$("#type_"+b).removeAttr("checked").trigger("change")})})}function updateLoginInfo(a){a&&(a=a.getGivenName(),console.log("Found Logged in User Name: ",a),login_name=a,signoutButton.innerHTML=" "+login_name,$("#monthly-report").addClass("hide"),$.each(admin_names,function(a){a==login_name.toUpperCase()&&(admin_login=!0,$("#monthly-report").removeClass("hide"),console.log("Showing Monthly Report button for user: ",a))}))}
function enable_v_filter(){$("#v-filter").removeClass("hide");event_list_table.yadcf([{column_number:0,filter_type:"multi_select",filter_container_id:"v-filter-1"},{column_number:1,text_data_delimiter:",",filter_type:"multi_select",filter_container_id:"v-filter-2"},{column_number:3,text_data_delimiter:",",filter_type:"multi_select",filter_container_id:"v-filter-3"}])}
function getUrlVars(){for(var a=[],b,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<c.length;e++)b=c[e].split("="),a.push(b[0]),b[1]&&b[1].match("#")&&(b[1]=b[1].split("#")[0]),a[b[0]]=b[1];return a}
function process_all_events(a){var b=[],c={},e={};cumulative_data={};var f;if(a&&0<a.length)for(i=0;i<a.length;i++){f=a[i];var k=get_dataTime(f.start),g=get_dataTime(f.end),h=split_summary(f.summary);f=days_diff(k,g);var l=f[0],m=f[1];f=getFormatedTime(k,l,g);var g=f[0],n=f[1],l=f[2];h[0].match(/^H/i)&&"HBD"!=h[0]&&(l/=2);b[i]=[h[0],h[1],g,n+", "+day,m,l];e[h[1]]=1;"HBD"==h[0]&&(c[h[1]]=g);(k=getAllBuisnessDates(k,l))&&$.each(k,function(a,b){if(!h||!h[0]||!h[1])return!0;cumulative_data[a]||(cumulative_data[a]=
{});cumulative_data[a][h[1]]||(cumulative_data[a][h[1]]={});cumulative_data[a][h[1]][h[0]]=cumulative_data[a][h[1]][h[0]]?cumulative_data[a][h[1]][h[0]].concat(b):b})}var p=$("#type_filter_box");$.each(Type_Filter,function(a,b){var c=b.replace(/ /g,"_");1>$("#type_"+c).length&&p.append("<input type='checkbox' checked='checked' id='type_"+c+"'>"+b+"</input> &nbsp;")});$("#global_search , #all-events_filter input").autocomplete({source:_.keys(e)});$("#all-events").DataTable().clear();$("#all-events").DataTable().rows.add(b).draw();
add_birthdays(c)}function getAllBuisnessDates(a,b){for(var c=a.clone(),e={},f=0;f<b;f++){var k=c.format("MMMM"),g=c.format("DD");e[k]||(e[k]=[]);e[k].push(g);c=c.businessAdd(1,"days")}return e}function get_dataTime(a){var b=a.dateTime;b||(b=a.date);return new moment(b)}function getFormatedTime(a,b,c){var e=a.format("YYYY-MM-DD"),f=a.format("MMM"),k=a.format("ddd");a.format("H");c.format("H");1>b&&(e+="<br>"+a.format("h:mm a"),e+=" - "+c.format("h:mm a"));return[e,f,k]}
function days_diff(a,b){var c=b.businessDiff(a,"days");0==c&&(c=1);var e=a.clone(),f=a.format("Do");if(5>c)for(var k=1;k<c;k++)e=e.businessAdd(1,"day"),f+=", "+e.format("Do");else f=a.format("MMM Do")+" to "+e.businessAdd(c-1,"day").format("MMM Do");return[c,f]}
function split_summary(a){if(!a)return["-","-"];var b=[],c=a.split(":");2>c.length&&(c=a.split("-"));c[0]=c[0].trim();c[1]&&(c[1]=c[1].trim());"Maternity Leave"==c[0]&&(c[0]="MtL");0<=temp_types.indexOf(c[0].toUpperCase())?(b[0]=c[0],c.splice(0,1)):c[1]&&0<=Type_Filter.indexOf(c[1].toUpperCase())?(b[0]=c[1],c.splice(1,1)):b[0]="-";b[0]=b[0].toUpperCase();b[1]=group_name_case_sensitive?c.toString().trim():c.toString().trim().toTitleCase();group_first_name&&b[1].match(" ")&&(b[1]=b[1].split(" ")[0]);
b[1]||(b[1]="-");return b}function get_time(a){var b="",c=a.getHours(),b=12>c?"AM":"PM";0==c&&(c=12);12<c&&(c-=12);a=a.getMinutes();a+="";1==a.length&&(a="0"+a);return c+":"+a+" "+b}function refresh_data(){progress_bar("Refreshing...");var a=getUrlVars();console.log(a);var a=$("#datepicker-from").val(),b=$("#datepicker-to").val();listEvents(a,b)}
function update_chart(){var a=$("#all-events").DataTable();a.on("search.dt",function(){clearTimeout(count_table_timer);count_table_timer=setTimeout(calculate_counts,500,a)})}
function chart_data(a,b,c,e){c={text:c};e={text:e};var f={categories:a,title:{text:null}},k=!1;40>a.length*b.length&&(k=!0);a={bar:{dataLabels:{enabled:!0,color:"#000",style:{fontWeight:"bolder"},formatter:function(){return this.x+": "+this.y},inside:!0,rotation:270}},series:{dataLabels:{enabled:k,color:"#FFFFFF",style:{fontWeight:"bolder"},formatter:function(){return this.y},inside:!0},pointPadding:0,groupPadding:.1}};k={layout:"vertical",align:"right",verticalAlign:"top",x:0,y:0,floating:!0,borderWidth:1,
backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",shadow:!0};e=_.defaults(e,{text:"Data based on the applied filter"});c=_.defaults(c,{text:"Graphical Representation"});var g={chart:{type:"column"}};g.title=c;g.subtitle=e;g.tooltip={valueSuffix:" day(s)"};g.xAxis=f;g.yAxis={min:0,title:{text:"Days",align:"high"},labels:{overflow:"justify"}};g.series=b;g.plotOptions=a;g.legend=k;g.credits={enabled:!0};return g}
function draw_graph(a,b){var c=_.keys(a),e=_.keys(b),f=[],k={};2>c.length?$("#chart-container").collapse("hide"):($.each(e,function(b,e){$.each(c,function(b,c){var f=a[c][e];f||(f=0);k[e]||(k[e]=[]);k[e].push(f)})}),$.each(e,function(a,b){k[b]||(k[b]=[]);f.push({name:b,data:k[b]})}),e=chart_data(c,f,"Name wise View"),$("#chart-container").highcharts(e),$("#chart-container").collapse("show"))}
function draw_monthly_chart(a){var b=[],c={},e="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),f=_.keys(a.types);$.each(e,function(b,e){var h=a[e];h||(h={});$.each(f,function(a,b){c[b]||(c[b]=[]);h[b]?c[b].push(h[b]):c[b].push(0)})});$.each(c,function(a,c){b.push({name:a,data:c})});e=chart_data(e,b,"Month wise View");$("#chart-container-monthly").highcharts(e);$("#chart-container-monthly").collapse("show")}
function draw_weekly_chart(a){var b=[],c={},e=["Mon","Tue","Wed","Thu","Fri"],f=_.keys(a.types);$.each(e,function(b,e){var h=a[e];h||(h={});$.each(f,function(a,b){c[b]||(c[b]=[]);h[b]?c[b].push(h[b]):c[b].push(0)})});$.each(c,function(a,c){b.push({name:a,data:c})});e=chart_data(e,b,"Day wise View");$("#chart-container-weekly").highcharts(e);$("#chart-container-weekly").collapse("show")}
function calculate_counts(a){progress_bar("Calculating counts...");$("div.tooltip").remove();var b={},c={},e={},f={};a=a.rows({filter:"applied"}).data();$.each(a,function(a,g){var h=g[0];b[g[1]]||(b[g[1]]={});h.match(/^H/i)&&"HBD"!=h&&(h=h.substring(1));b[g[1]][h]||(b[g[1]][h]=0);loging_data_computed||g[1]!=login_name||(logged_in_user_data[h]||(logged_in_user_data[h]=0),logged_in_user_data[h]+=g[5]);c[h]=1;b[g[1]][h]+=g[5];e=add_monthly_data(h,g,e);f=add_weekly_data(h,g,f)});loging_data_computed=
!0;populate_counts_table(b,_.keys(c));progress_bar("",!0);setTimeout(draw_fuel_graph,100);show_graph_flag&&(setTimeout(draw_monthly_chart,100,e),setTimeout(draw_weekly_chart,100,f),setTimeout(draw_graph,100,b,c))}
function add_monthly_data(a,b,c){if(!b[2]||!b[5])return c;if("-"!=a){var e=b[5];b=moment(b[2].split(" ")[0]);if(2>e)return _add_month_data(c,b,a,e);var f=b.clone().businessAdd(e);if(b.format("MMM")==f.format("MMM"))return _add_month_data(c,b,a,e);for(f=0;f<e;f++)c=_add_month_data(c,b,a,1),b.businessAdd(1,"day")}return c}
function add_weekly_data(a,b,c){if(!b[2]||!b[5])return c;if("-"!=a){var e=b[5];b=moment(b[2].split(" ")[0]);if(2>e)return _add_weekly_data(c,b,a,e);for(var f=0;f<e;f++)c=_add_weekly_data(c,b,a,1),b=b.businessAdd(1,"day")}return c}function _add_month_data(a,b,c,e){b=b.format("MMM");a[b]?a[b][c]||(a[b][c]=0):(a[b]={},a[b][c]=0);a[b][c]+=e;a.types||(a.types={});a.types[c]=1;return a}
function _add_weekly_data(a,b,c,e){b=b.format("ddd");a[b]?a[b][c]||(a[b][c]=0):(a[b]={},a[b][c]=0);a[b][c]+=e;a.types||(a.types={});a.types[c]=1;return a}
function populate_counts_table(a,b){all_events_report&&all_events_report.fnDestroy({remove:1});$("#report-table-cnt").html("<table id='all-events-report' class='table table-striped'></table>");var c=$("#all-events-report"),e="<thead><tr><th>Name<br/></th>";$.each(b,function(a,b){e+="<th>"+b+"</th>"});e+="</tr></thead>";c.html(e);$.each(a,function(a,k){e="<tr>";e+='<td class="link">'+a+"</td>";$.each(b,function(b,c){if(k[c]&&0<k[c]){var l="link high",m=c+" : "+a+"\nTaken/Applied: "+k[c];if(event_limits[c]){var n=
k[c]/event_limits[c]*100,m=m+(" leave(s)  ("+parseInt(n)+"%)"),p=event_limits[c]-k[c];0<p?m+="\nRemaining: "+p+" leave(s)":0>p&&(m+="\nOverdue: "+-1*p+" leave(s)");100<n?(l+=" danger",m+="\nAlready in LOP"):100==n?(l+=" warning",m+="\nUsed all"):80<n&&(l+=" warning")}e+='<td class="'+l+'" data-toggle="tooltip" title="'+m+'">'+k[c]+"</td>"}else e+='<td class="link high">0</td>'});e+="</tr>";c.append(e)});c.find("td").tooltip({container:"body"});all_events_report=$("#all-events-report").dataTable({bJQueryUI:!0,
bProcessing:!0,iDisplayLength:50}).yadcf([{column_number:0}])}function set_today_event(a){today_events[a[0]]?today_events[a[0]][a[1]]||(today_events[a[0]][a[1]]=0):today_events[a[0]]={};today_events[a[0]][a[1]]++}
function create_event(a){if(!validate_session())return!1;var b={timeZone:"Asia/Kolkata"},c={timeZone:"Asia/Kolkata"};"FULL"==a.add_event_day?(b.dateTime=moment(a.from_date+" 10:00","DD/MM/YYYY HH:mm").format("YYYY-MM-DDTHH:mm:ss"),c.dateTime=moment(a.to_date+" 18:30","DD/MM/YYYY HH:mm").format("YYYY-MM-DDTHH:mm:ss")):"FH"==a.add_event_day?(b.dateTime=moment(a.from_date+" 10:00","DD/MM/YYYY HH:mm").format("YYYY-MM-DDTHH:mm:ss"),c.dateTime=moment(a.from_date+" 13:00","DD/MM/YYYY HH:mm").format("YYYY-MM-DDTHH:mm:ss")):
"SH"==a.add_event_day&&(b.dateTime=moment(a.from_date+" 14:00","DD/MM/YYYY HH:mm").format("YYYY-MM-DDTHH:mm:ss"),c.dateTime=moment(a.from_date+" 18:30","DD/MM/YYYY HH:mm").format("YYYY-MM-DDTHH:mm:ss"));a={summary:a.new_event_title,location:a.location,description:a.description,reminders:{useDefault:!0},start:b,end:c};b="Title:  "+a.summary+"\n";b+="From:  "+a.start.dateTime+"\n";b+="To:  "+a.end.dateTime+"\n \n";confirm(b+" I will be creating above event.")?(progress_bar("Creating event..."),gapi.client.calendar.events.insert({calendarId:Calendar_id,
resource:a}).execute(function(a){gapi_resp_process(a,function(){$("#add_event_modal").modal("hide")});progress_bar("",!0)})):console.log("User cancelled create event!")}function getFormDataAsJSON(a){var b={};a=a.serializeArray();$.each(a,function(){b[this.name]?(b[this.name].push||(b[this.name]=[b[this.name]]),b[this.name].push(this.value||"")):b[this.name]=this.value||""});return b}
function getBiMonthlyTable(a){var b=$('<table class="table">'),c=temp_types.length,c=c-2,e=0;$.each(a,function(a,k){if(!$("#bi-"+a).length||!$("#bi-"+a).is(":checked"))return!0;b.append("<tr></tr>");b.append("<tr></tr>");b.append('<tr><th colspan="'+c+'"><b><center>'+a+"</center></b></th></tr>");var g=$("<tr>");g.append("<td></td>");$.each(temp_types,function(a,b){if(b.match(/HBD|-$/))return!0;g.append("<td><b><center>"+b+"</center></b></td>")});b.append(g);$.each(k,function(a,c){var f=$("<tr>");
f.append("<td><strong>"+a+"</strong></td>");var k=_.keys(c);if(1==k.length&&"-"==k[0])return!0;var g=!1;$.each(temp_types,function(a,b){if(b.match(/HBD|-$/))return!0;c[b]?(f.append("<td>"+c[b]+"</td>"),g=!0):f.append("<td>-</td>")});g&&(b.append(f),e=1)})});if(0!=e)return b}function delete_event(a){gapi.client.calendar.events["delete"]({calendarId:Calendar_id,eventId:a}).execute(function(a){gapi_resp_process(a,function(){$("#add_event_modal").modal("hide")})})}
function gapi_resp_process(a,b){console.log("GAPI Response: ",a);if(a.error){var c="ERROR: "+a.error.message;"Dinesh"!=login_name&&(c+="\nSeems bug? Inform to Dinesh D!");m_alert(c)}else a.status&&"confirmed"==a.status?(listEvents(),b&&b()):m_alert("Something went wrong!")}var progress_bar_timer;function progress_bar(a,b){b?(clearTimeout(progress_bar_timer),$(".processing").hide()):($("#processing_msg").text(a),progress_bar_timer=setTimeout(function(){$(".processing").show()},1))}
var d3Gauges={},d3_gauge_config=liquidFillGaugeDefaultSettings();d3_gauge_config.circleColor="#2fbeb5";d3_gauge_config.minValue=0;d3_gauge_config.maxValue=total_emps;d3_gauge_config.textColor="#FF4444";d3_gauge_config.waveTextColor="#FFAAAA";d3_gauge_config.waveColor="#2fbea4";d3_gauge_config.circleThickness=.05;d3_gauge_config.textVertPosition=.8;d3_gauge_config.waveAnimateTime=1E3;d3_gauge_config.displayPercent=!1;var today_event_names={},today_events_count={},d3_fuel_grap_drawn=!1;
function draw_fuel_graph(){if(!d3_fuel_grap_drawn){$("#total_events_gauge").collapse("show");var a=total_emps;today_event_names={};today_events_count={};$.each(temp_types,function(b,c){if(!today_events[c]||"-"==c||"HBD"==c)return!0;var k=_.keys(today_events[c]),g=k.length;c.match(/^H/i)&&(g/=2,c=c.substring(1));a-=g;today_event_names[c]||(today_event_names[c]=[],today_events_count[c]=0);$.each(k,function(a,b){today_event_names[c].push(b)});today_events_count[c]+=g});today_events_count.TOTAL=a;$.each(["TOTAL",
"WFH","SL","PL"],function(a,b){today_events_count[b]||(today_events_count[b]=0);d3Gauges["gauge_"+b]?d3Gauges["gauge_"+b].update(today_events_count[b]):d3Gauges["gauge_"+b]=loadLiquidFillGauge("fillgauge_"+b,today_events_count[b],d3_gauge_config)});$.each(["SL","PL"],function(a,b){var c=d3_gauge_config;c.maxValue=event_limits[b];logged_in_user_data[b]||(logged_in_user_data[b]=0);d3Gauges["gauge_ind"+b]?d3Gauges["gauge_ind"+b].update(logged_in_user_data[b]):d3Gauges["gauge_ind"+b]=loadLiquidFillGauge("fillgauge_ind_"+
b,logged_in_user_data[b],c)});d3_fuel_grap_drawn=!0;$("#show-graph").trigger("click");var b=getUrlVars(),c=login_name;admin_names[login_name.toUpperCase()]&&(c="");b.search&&(c=b.search);c&&""!=c&&($("#all-events").DataTable().search(c).draw(),$("#global_search").val(c))}}
function show_event_names(a){if(a.match(/^IN-/)){a=a.split("-")[1];var b="You("+login_name+") have taken/applied ",b=b+(logged_in_user_data[a]+" "+a+" out of "+event_limits[a]);m_alert(b+"\n \n*Counts calculated per calendar year","Your("+login_name+") "+a)}else"ALL"==a?m_alert("I don't have all the names to display","Today Present"):today_event_names[a]?(b="Today "+a+" taken by \n \n"+today_event_names[a].join(", "),m_alert(b,"Today "+a)):m_alert("No "+a+" today, or no one updated today","Today "+
a)}function m_alert(a,b){var c=$("#alert-modal");b||(b="Alert");c.find(".title").html(b);a=a.replace(/(?:\&rho;n|\r|\n)/g,"<br>");c.find(".body").html(a);c.modal("show")}var bd_done=!1;
function add_birthdays(a){if(bd_done)return!1;var b=$("#birthdays_list tbody");b.html("");var c=moment();for(name in a){var e=moment(a[name]);e<c&&(e=e.add(1,"year"));var f=e.format("MMM, Do - ddd"),k=e.format("YYYYMMDD"),g="";e.isBusinessDay()||(g="danger");b.append('<tr class="'+g+'"><td data-order="'+k+'">'+f+"</td><td>"+name+"</td></tr>")}$("#birthdays_list").DataTable({paging:!1});bd_done=!0};String.prototype.toTitleCase=function(){return this.toString().toLowerCase().replace(/\b(\w)/g,function(a){return a.toUpperCase()})};
